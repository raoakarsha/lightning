version: 2.1
jobs:
  test:
    docker:
      - image: "vault.habana.ai/gaudi-docker/1.7.1/ubuntu20.04/habanalabs/pytorch-installer-1.13.0:latest"
        environment:
          HABANA_VISIBLE_DEVICES: all
          OMPI_MCA_btl_vader_single_copy_mechanism: none
     
    steps:
      - checkout
      - run:
         name: habana docker image
         command: |
          # perform all required actions
            echo "##vso[task.setvariable variable=CONTAINER_ID]$(head -1 /proc/self/cgroup|cut -d/ -f3)"
            # install sudo in container
            sh -c "apt-get update && DEBIAN_FRONTEND=noninteractive apt-get -o Dpkg::Options::="--force-confold" -y install sudo"
            sudo pip list
            sudo pip uninstall -y lightning pytorch-lightning
            sudo pip list
 #     - run:
 #         name: Run tests
 #         command: |
 #           python -m pytest --cov-report xml --cov-report term --cov .
 
   build-Docs:
    docker:
      - image: readthedocs/build:latest
    steps:
      - checkout
      - run:
          command: |
            git submodule update --init --recursive
          name: Init git submodule
      - *make_docs
      - store_artifacts:
          # allows us to preview the generated html pages
          path: docs/build/html/
          destination: html

      
workflows:
  test:
    jobs:
      - test
      - build-Docs
